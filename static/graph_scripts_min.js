function drawGraph(t,a,e){if(e){var r=d3.select(".container").append("svg").attr("width",containerwidth).attr("height",containerHeight),i=r.append("svg").attr("width",width+60).attr("height",height+margin.bottom+margin.top+legendHeight).attr("class","lineChart").attr("y",50).append("g").attr("transform","translate(0,"+(legendHeight+margin.top)+")"),n=r.append("svg").attr("class","legendGroup").attr("width",legendWidth).attr("height",legendHeight).attr("x",0).attr("y",margin.top).append("g").attr("transform","translate(0,10)");n.append("text").attr("class","legendTitle").append("svg:tspan").attr("x",0).attr("dy",5).text("Click to hide/show");var l=n.append("svg").attr("x",200).attr("y",20).attr("class","vietNamGroup").attr("width",legendWidth).on("click",function(){var r=vietnamPathActive,n=r?.5:1;d3.selectAll(".vietNamGroup").style("opacity",n),vietnamPathActive=r?!1:!0,i=populateAxis(t,a,vietnamPathActive,indiaPathActive,thailandPathActive,i,e)}).append("a").attr("href","#0").append("g");l.append("line").attr("stroke",vietnamColor).attr("stroke-width","5px").attr("width",10).attr("x",0).attr("y",0).attr("x2",10).attr("y2",0),l.append("text").attr("class","legend").attr("x",15).attr("dy",10).style("fill",textColor).text("Vietnam");var d=n.append("svg").attr("x",0).attr("y",20).attr("class","indiaGroup").attr("width",legendWidth).on("click",function(){var r=indiaPathActive,n=r?.5:1;d3.selectAll(".indiaGroup").style("opacity",n),indiaPathActive=r?!1:!0,i=populateAxis(t,a,vietnamPathActive,indiaPathActive,thailandPathActive,i,e)}).append("a").attr("href","#0").append("g");d.append("line").attr("stroke",indiaColor).attr("stroke-width","5px").attr("width",10).attr("x",0).attr("y",0).attr("x2",10).attr("y2",0),d.append("text").attr("class","legend").attr("x",15).attr("dy",10).style("fill",textColor).text("India");var o=n.append("svg").attr("x",100).attr("y",20).attr("class","thailandGroup").attr("width",legendWidth).on("click",function(){var r=thailandPathActive,n=r?.5:1;d3.selectAll(".thailandGroup").style("opacity",n),thailandPathActive=r?!1:!0,i=populateAxis(t,a,vietnamPathActive,indiaPathActive,thailandPathActive,i,e)}).append("a").attr("href","#0").append("g");o.append("line").attr("stroke",thailandColor).attr("stroke-width","5px").attr("width",10).attr("x",0).attr("y",0).attr("x2",10).attr("y2",0),o.append("text").attr("class","legend").attr("x",15).attr("dy",10).style("fill",textColor).text("Thailand")}else{var r=d3.select(".container").append("svg").attr("width",containerwidth).attr("height",containerHeight),i=r.append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).attr("class","lineChart").append("g").attr("transform","translate(0,"+margin.top+")"),n=r.append("svg").attr("class","legendGroup").attr("width",legendWidth).attr("height",legendHeight).attr("x",width).attr("y",margin.top).append("g").attr("transform","translate(20,10)");n.append("text").attr("class","legendTitle").append("svg:tspan").attr("x",0).attr("dy",5).text("Click to").append("svg:tspan").attr("x",0).attr("dy",15).text("hide/show");var l=n.append("svg").attr("x",0).attr("y",110).attr("class","vietNamGroup").attr("width",legendWidth).on("click",function(){var r=vietnamPathActive,n=r?.5:1;d3.selectAll(".vietNamGroup").style("opacity",n),vietnamPathActive=r?!1:!0,i=populateAxis(t,a,vietnamPathActive,indiaPathActive,thailandPathActive,i,e)}).append("a").attr("href","#0").append("g");l.append("line").attr("stroke",vietnamColor).attr("stroke-width","5px").attr("width",10).attr("x",0).attr("y",0).attr("x2",10).attr("y2",0),l.append("text").attr("class","legend").attr("x",15).attr("dy",10).style("fill",textColor).text("Vietnam");var d=n.append("svg").attr("x",0).attr("y",50).attr("class","indiaGroup").attr("width",legendWidth).on("click",function(){var r=indiaPathActive,n=r?.5:1;d3.selectAll(".indiaGroup").style("opacity",n),indiaPathActive=r?!1:!0,i=populateAxis(t,a,vietnamPathActive,indiaPathActive,thailandPathActive,i,e)}).append("a").attr("href","#0").append("g");d.append("line").attr("stroke",indiaColor).attr("stroke-width","5px").attr("width",10).attr("x",0).attr("y",0).attr("x2",10).attr("y2",0),d.append("text").attr("class","legend").attr("x",15).attr("dy",10).style("fill",textColor).text("India");var o=n.append("svg").attr("x",0).attr("y",80).attr("class","thailandGroup").attr("width",legendWidth).on("click",function(){var r=thailandPathActive,n=r?.5:1;d3.selectAll(".thailandGroup").style("opacity",n),thailandPathActive=r?!1:!0,i=populateAxis(t,a,vietnamPathActive,indiaPathActive,thailandPathActive,i,e)}).append("a").attr("href","#0").append("g");o.append("line").attr("stroke",thailandColor).attr("stroke-width","5px").attr("width",10).attr("x",0).attr("y",0).attr("x2",10).attr("y2",0),o.append("text").attr("class","legend").attr("x",15).attr("dy",10).style("fill",textColor).text("Thailand")}var s=r.append("text").attr("class","yAxisTitle").text("Thousand metric tonnes").attr("dy",margin.top-30);e&&s.attr("dy","30"),i=populateAxis(t,a,vietnamPathActive,indiaPathActive,thailandPathActive,i,e)}function populateAxis(t,e,r,i,n,l,d){function o(t){var a=t.selection?t.selection():t;t.call(T),a.selectAll(".tick line").filter(Number).attr("stroke","#333333").attr("y2",30).attr("y1",30).transition().ease(transitionType).duration(1e3).attr("y2",0).attr("y1",0),a.selectAll(".tick text").attr("x",4).attr("dy",-4).attr("dy",26).transition().ease(transitionType).duration(1e3).attr("dy",-4),a!==t&&t.selectAll(".tick text").attrTween("x",null).attrTween("dy",null)}var s=r?1:.5;d3.selectAll(".vietNamGroup").style("opacity",s);var p=i?1:.5,c=200,h=0,g=100,v=110,m=50,u=80;d3.selectAll(".indiaGroup").style("opacity",p),d?(i||(n&&r&&(h=200,g=0,c=100),r||(g=0,h=100),n||(c=0,g=200,h=100),r||n||(c=200,g=100,h=0)),n||i&&r&&(c=100,g=200),d3.selectAll(".thailandGroup").transition().ease(transitionType).duration(1e3).attr("x",g),d3.selectAll(".indiaGroup").transition().ease(transitionType).duration(1e3).attr("x",h),d3.selectAll(".vietNamGroup").transition().ease(transitionType).duration(1e3).attr("x",c)):(i||(n&&r&&(m=110,u=50,v=80),n&&!r&&(u=50,m=80),n||(v=50,u=110,m=80),r||n||(v=110,u=80,m=50)),n||i&&r&&(v=80,u=110),d3.selectAll(".thailandGroup").transition().ease(transitionType).duration(1e3).attr("y",u),d3.selectAll(".indiaGroup").transition().ease(transitionType).duration(1e3).attr("y",m),d3.selectAll(".vietNamGroup").transition().ease(transitionType).duration(1e3).attr("y",v));var f=n?1:.5;d3.selectAll(".thailandGroup").style("opacity",f),x.domain(d3.extent(t,function(t){return t.year}));var A=5,w=5,k=0,P=width+5;d&&(A=2,w=5,k=50,P=width+k+5);var C=d3.axisBottom().scale(x).ticks(A).tickFormat(function(t){return formatDate=d3.timeFormat("%Y"),this.parentNode===this.parentNode.parentNode.firstChild.nextSibling?" ":formatDate(t)});d3.select(".x_axis")&&d3.select(".x_axis").remove();var T=(l.append("g").attr("class","x_axis").attr("transform","translate("+k+","+(height+30)+")").transition().ease(transitionType).duration(1e3).attr("transform","translate("+k+","+height+")").call(C),d3.axisRight(y).ticks(w).tickSize(P).tickFormat(function(t){if(0!=t)var a=d3.format(numberFormat)(t);else var a=0;return" "+a})),G=[];r&&G.push("Vietnam"),n&&G.push("Thailand"),i&&G.push("India");var F=d3.max(e,function(t){return d3.max(t,function(t){return-1!=G.indexOf(t.key)?t.value:void 0})}),N=0;do N+=5e3;while(F>N);y.domain([0,N]),l.select(".y_axis")&&l.select(".y_axis").remove();l.append("g").attr("class","y_axis").call(o);if(l.select("#vietNamPath")&&l.select("#vietNamPath").remove(),l.select("#thailandPath")&&l.select("#thailandPath").remove(),l.select("#indiaPath")&&l.select("#indiaPath").remove(),r){var V=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.Vietnam)});l.append("path").attr("class","line").attr("stroke",vietnamColor).attr("id","vietNamPath").attr("transform","translate("+k+",60)").transition().ease(transitionType).duration(1e3).attr("transform","translate("+k+",0)").attr("d",V(t))}if(i){var D=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.India)});l.append("path").attr("class","line").attr("stroke",indiaColor).attr("id","indiaPath").attr("transform","translate("+k+",60)").transition().ease(transitionType).duration(1e3).attr("transform","translate("+k+",0)").attr("d",D(t))}if(n){var H=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.Thailand)});l.append("path").attr("class","line").attr("stroke",thailandColor).attr("id","thailandPath").attr("transform","translate(0"+k+",60)").transition().ease(transitionType).duration(1e3).attr("transform","translate("+k+",0)").attr("d",H(t))}return l.selectAll("circle").remove(),l.selectAll(".legendLine").remove(),d3.selectAll(".legendText").remove(),d3.select(".tooltipMobile").remove(),d3.select(".lineChart").on("click",function(){var t=d3.mouse(this);a=t[0],b=t[1],d&&(a-=k);var o=x.invert(a);formatDate=d3.timeFormat("%Y"),o=formatDate(o),e[0].forEach(function(t){formatDate(t.year)==o&&(vietNamVal=t.value,xLabel=t.year)}),e[1].forEach(function(t){formatDate(t.year)==o&&(indiaVal=t.value)}),e[2].forEach(function(t){formatDate(t.year)==o&&(thailandVal=t.value,xLabel=t.year)}),l.selectAll(".legendLine").remove();var s=x(xLabel);if(d&&(s+=k),l.append("line").attr("x1",s).attr("y1",0).attr("x2",s).attr("y2",height).attr("stroke","#333").attr("opacity",.3).attr("class","legendLine").attr("stroke-width","2"),d3.select(".legendYear").remove(),d3.selectAll(".legendText").remove(),d3.select(".tooltipMobile").remove(),d){var p=l.append("g").attr("class","tooltipMobile").attr("transform","translate(0,"+margin.top+")"),c=x(xLabel)+10;c=c+150>width?40:c,p.append("rect").attr("width",150).attr("height",120).attr("fill","#FFF").attr("stroke",textColor).attr("stroke-width",.5).attr("x",c).attr("y",5);var h=p.append("svg").append("g").attr("width",150).attr("height",120).attr("transform","translate("+(c+10)+",10)");h.append("text").attr("class","legendText").text(o).attr("fill",textColor).attr("x",0).attr("y",25);var g=85,v=45,m=65,u=0;h.append("line").attr("stroke",vietnamColor).attr("stroke-width","5px").attr("width",10).attr("x1",u).attr("y1",g).attr("x2",u+10).attr("y2",g),h.append("text").attr("class","legend").attr("x",u+15).attr("dy",g+10).style("fill",textColor).text("Vietnam"),h.append("text").attr("class","legendText").text(vietNamVal).attr("fill",textColor).attr("x",u+95).attr("y",g+10),h.append("line").attr("stroke",indiaColor).attr("stroke-width","5px").attr("width",10).attr("x1",u).attr("y1",v).attr("x2",u+10).attr("y2",v),h.append("text").attr("class","legend").attr("x",u+15).attr("dy",v+10).style("fill",textColor).text("India"),h.append("text").attr("class","legendText").text(indiaVal).attr("fill",textColor).attr("x",u+95).attr("y",v+10),h.append("line").attr("stroke",thailandColor).attr("stroke-width","5px").attr("width",10).attr("x1",u).attr("y1",m).attr("x2",u+10).attr("y2",m),h.append("text").attr("class","legend").attr("x",u+15).attr("dy",m+10).style("fill",textColor).text("Thailand"),h.append("text").attr("class","legendText").text(thailandVal).attr("fill",textColor).attr("x",u+95).attr("y",m+10)}else legendGroup=d3.select(".legendGroup g"),legendGroup.append("text").attr("class","legendYear").text(o).attr("x",0).attr("dy",40),d3.selectAll(".vietNamGroup").append("text").attr("class","legendText").attr("x",0).attr("dy",25).style("fill",textColor).text(d3.format(numberFormat2)(vietNamVal)),d3.selectAll(".indiaGroup").append("text").attr("class","legendText").attr("x",0).attr("dy",25).style("fill",textColor).text(d3.format(numberFormat2)(indiaVal)),d3.selectAll(".thailandGroup").append("text").attr("class","legendText").attr("x",0).attr("dy",25).style("fill",textColor).text(d3.format(numberFormat2)(thailandVal));var f=[];r&&(newData={x:xLabel,y:vietNamVal,color:vietnamColor},f.push(newData)),i&&(newData={x:xLabel,y:indiaVal,color:indiaColor},f.push(newData)),n&&(newData={x:xLabel,y:thailandVal,color:thailandColor},f.push(newData)),l.selectAll("circle").remove(),l.selectAll("circle").data(f).enter().append("circle").attr("r",radius).attr("cx",function(t){return x(t.x)+k}).attr("cy",function(t){return y(t.y)}).attr("fill",function(t){return t.color}).attr("stroke","#FFF")}),l}function resize(){loadedData&&(d3.select(".container svg").remove(),containerwidth=d3.select(".container").node().getBoundingClientRect().width,450>=containerwidth?(width=containerwidth-60,containerHeight=height+legendHeight+(margin.top+margin.bottom+margin.top),legendWidth=containerwidth,legendHeight=40,height=400-legendHeight-margin.top-margin.bottom,isMobile=!0):(isMobile=!1,containerHeight=450,width=.87*containerwidth-margin.right-margin.left,legendWidth=Math.round(.17*containerwidth),height=400-margin.top-margin.bottom,legendHeight=300),x=d3.scaleTime().range([0,width]),y=d3.scaleLinear().range([height,0]),dataArr&&drawGraph(dataArr[0],dataArr[1],isMobile))}var containerwidth,containerHeight,margin={top:70,right:40,bottom:70,left:50},width,height=400-margin.top-margin.bottom,legendWidth,legendHeight=300,radius=4,vietnamPathActive=!0,thailandPathActive=!0,indiaPathActive=!0,vietnamColor="#FED47D",indiaColor="#FABE9C",thailandColor="#F6AB9A",textColor="#333333",numberFormat=",.2r",numberFormat2=",",x,y,dataArr,loadedData=!1,isMobile=!1,transitionType=d3.easeSin,dataArr=d3.csv("static/milledRiceEndingStocks.csv",function(t,a){var e=d3.timeParse("%Y");a.forEach(function(t){t.year=e(t[a.columns[0]]),t.Vietnam=+t.Vietnam,t.India=+t.India,t.Thailand=+t.Thailand}),series=a.columns.slice(1,4).map(function(t){return a.map(function(a){return{key:t,year:a.year,value:+a[t]}})}),dataArr[0]=a,dataArr[1]=series,loadedData=!0,resize()});d3.select(window).on("resize",resize);